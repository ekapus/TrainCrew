<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, intermediate-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Intermediate Airbrake Test</title>


  <meta property="og:title" content="TrainCrew Webapp: Intermediate Airbrake Test" />
  <meta property="og:description" content="Simulate performing an intermediate airbrake test." />
  <meta property="og:type" content="website" />

  <!-- Bootstrap -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/site.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
  <!-- Fixed navbar -->
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false"
          aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        <a class="navbar-brand" href="/index.html">TrainCrew</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="switching.html">Switching</a></li>
          <li><a href="handbrakes.html">Handbrakes</a></li>
          <li class="active"><a href="airbrakes.html">Airbrakes</a></li>
          <li><a href="locomotive.html">Locomotives</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="about.html">About</a></li>
        </ul>

      </div>
      <!--/.nav-collapse -->
    </div>
  </nav>

  <div class="container body-container">

    <!-- Main component for a primary marketing message or call to action -->
    <h1>Intermediate Airbrake Test</h1>
    <div class="well">
      <p>To be performed enroute when cars are added or removed from the trainline. Only new cars need be tested.</p>
    </div>

    <ul class="list-group">
      <li class="list-group-item step step-1 ">
        <p>Fully Charge the trainline. (3 seconds per car.)</p>
        <label for="airbrake-intermediate-test-car-count">Cars Added</label>
        <div class="input-group input-group-lg col-xs-7">
          <input name="airbrake-intermediate-test-car-count" type="number" id="airbrake-intermediate-test-car-count" class="form-control airbrake-intermediate-test-car-count" placeholder="number"
            aria-describedby="number-of-cars">
          <span class="input-group-addon" id="number-of-cars">cars</span>
        </div>
        <button type="button" class="btn btn-lg btn-default airbrake-intermediate-test-charge">Charge Train Line</button>

        <div class="progress airbrake-intermediate-test-charge-progress hidden">
          <div class="progress-bar airbrake-intermediate-test-charge-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 5em;">
            0 PSI
          </div>
        </div>
      </li>
      <li class="list-group-item step step-2">
        <p>Set brakes and hold pressure for 1 minute (15 seconds fast clock).</p>
        <button type="button" class="btn btn-lg btn-default airbrake-intermediate-test-set">Set Brakes</button>
        <div class="progress airbrake-intermediate-test-set-progress hidden">
          <div class="progress-bar airbrake-intermediate-test-set-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em;">
            0 PSI
          </div>
        </div>
        
      </li>
      <li class="list-group-item step step-3">
        <p>Confirm pressure at the end of the trainline.</p>
        <button type="button" class="btn btn-lg btn-default airbrake-intermediate-test-confirm">Confirm Pressure</button>
        <div class="alert airbrake-intermediate-test-confirm-badge"></div>
      </li>
      <li class="list-group-item step step-4">
        <p>Visually inspect all brakes for application.</p>
        <button type="button" class="btn btn-lg btn-default airbrake-intermediate-test-inspect">Inspect</button>
        <div class="progress airbrake-intermediate-test-inspect-progress hidden">
          <div class="progress-bar airbrake-intermediate-test-inspect-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 5em;">
            0 Cars Inspected
          </div>
        </div>        
      </li>
      <li class="list-group-item step step-5">
        <p>Release brakes.</p>
        <button type="button" class="btn btn-lg btn-default airbrake-intermediate-test-release">Release</button>
        <div class="alert airbrake-intermediate-test-release-badge"></div>
      </li>
      <li class="list-group-item step step-6">
        <p>Visually inspect all brakes for release.</p>
        <button type="button" class="btn btn-lg btn-default airbrake-intermediate-test-inspect-release">Inspect</button>
        <div class="progress airbrake-intermediate-test-inspect-release-progress hidden">
          <div class="progress-bar airbrake-intermediate-test-inspect-release-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 5em;">
            0 Cars Inspected
          </div>
        </div>        
      </li>
      <li class="list-group-item step step-7">
        <div class="alert airbrake-intermediate-test-success-badge"></div>
      </li>
    </ul>
<hr />
    <ul class="nav nav-pills">
      <li class="nav-item">
        <a class="nav-link" href="airbrakes.html">Back to Airbrakes</a>
      </li>
      <li class="nav-item">        
        <a class="nav-link" href="/index.html">Home</a>
      </li>


  </div>
  <!-- /container -->

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="js/site.js"></script>

  <script>

$(document).ready(function () {
    $(".step").hide();
    $(".step-1").show();



    disable($(".airbrake-intermediate-test-charge"));

    $(".airbrake-intermediate-test-car-count").on("change keyup paste", function () {
        var val = $("#airbrake-intermediate-test-car-count").val();
        if (!isNaN(val)) {
            enable($(".airbrake-intermediate-test-charge"));
        } else {
            disable($(".airbrake-intermediate-test-charge"));
        }

    });

    var maxBrakePipePressure = 90; // Potential air pressure range
    var brakePipePressure = maxBrakePipePressure;


    $(".airbrake-intermediate-test-charge").click(function () {

        disable($("#airbrake-intermediate-test-car-count"));

        var totalSeconds = $("#airbrake-intermediate-test-car-count").val();
        totalSeconds = parseInt(totalSeconds, 10);
        totalSeconds = totalSeconds * 3;

        percentPerSecond = 100 / totalSeconds;

        $(".airbrake-intermediate-test-charge").hide();

        $(".airbrake-intermediate-test-charge-progress").show();
        $(".airbrake-intermediate-test-charge-progress").removeClass("hidden");

        var compressorRunAudio = new Audio("sounds/compressor-run.wav");
        compressorRunAudio.loop = true;
        compressorRunAudio.play();

        var secondsElapsed = 0;
        var countDown = new Countdown({
            seconds: parseInt(totalSeconds),  // number of seconds to count down
            onUpdateStatus: function (sec) {
                var progressBar = $('.airbrake-intermediate-test-charge-progress-bar')
                var percentComplete = secondsElapsed * (percentPerSecond);
                secondsElapsed++;
                progressBar.css('width', percentComplete + '%').attr('aria-valuenow', percentComplete);
                progressBar.text(Math.round(percentComplete * (maxBrakePipePressure / 100)) + " PSI");
            }, // callback for each second
            onCounterEnd: function () {
                var progressBar = $('.airbrake-intermediate-test-charge-progress-bar')
                progressBar.css('width', '100% Complete').attr('aria-valuenow', 100);
                progressBar.text(maxBrakePipePressure + " PSI");
                progressBar.addClass("progress-bar-success");
                compressorRunAudio.pause();   
                PlaySound("/sounds/compressor-end.wav");             
                $(".step-2").show();
            } // final action
        });
        countDown.start();

        

    });


    $(".airbrake-intermediate-test-set").click(function () {

        $(".airbrake-intermediate-test-set").hide();

        var totalSeconds = 15;
        brakePipePressure = maxBrakePipePressure - Math.round(generateRandomNumber(0, 2)); // Potential air pressure differences
        percentPerSecond = 100 / totalSeconds;

        $(".airbrake-intermediate-test-set-progress").show();
        $(".airbrake-intermediate-test-set-progress").removeClass("hidden");

        PlaySound("/sounds/air-purge-4.wav");

        var secondsElapsed = 0;
        var countDown = new Countdown({
            seconds: parseInt(totalSeconds),  // number of seconds to count down
            onUpdateStatus: function (sec) {
                var progressBar = $('.airbrake-intermediate-test-set-progress-bar')
                var percentComplete = secondsElapsed * (percentPerSecond);
                secondsElapsed++;
                progressBar.css('width', percentComplete + '%').attr('aria-valuenow', percentComplete);
                progressBar.text(secondsElapsed);
            }, // callback for each second
            onCounterEnd: function () {
                var progressBar = $('.airbrake-intermediate-test-set-progress-bar')
                progressBar.css('width', '100% Complete').attr('aria-valuenow', 100);
                progressBar.text(brakePipePressure + " PSI");
                progressBar.addClass("progress-bar-success");
                $(".step-3").show();
            } // final action
        });
        countDown.start();

        $(".airbrake-intermediate-test-charge").hide();

    });

    $(".airbrake-intermediate-test-confirm").click(function () {

        $(".airbrake-intermediate-test-confirm").hide();

        brakePipePressure = brakePipePressure - Math.round(generateRandomNumber(1, 3)); // Potential air pressure differences
        $(".airbrake-intermediate-test-confirm-badge").addClass("alert-success");
        $(".airbrake-intermediate-test-confirm-badge").text(brakePipePressure + " PSI");
        $(".airbrake-intermediate-test-confirm-badge").show();
        $(".step-4").show();

    });


    $(".airbrake-intermediate-test-inspect").click(function () {

        $(".airbrake-intermediate-test-inspect").hide();
        var carsToInspect = $("#airbrake-intermediate-test-car-count").val();
        var totalSeconds = parseInt(carsToInspect, 10);
        totalSeconds = totalSeconds * 4;

        carsPerSecond = carsToInspect / totalSeconds;
        percentPerSecond = 100 / totalSeconds;

        $(".airbrake-intermediate-test-inspect-progress").show();
        $(".airbrake-intermediate-test-inspect-progress").removeClass("hidden");

        carSuffix = "";

        var carsInspected = 0;
        var secondsElapsed = 0;
        var countDown = new Countdown({
            seconds: parseInt(totalSeconds),  // number of seconds to count down
            onUpdateStatus: function (sec) {
                secondsElapsed++;
                var progressBar = $('.airbrake-intermediate-test-inspect-progress-bar')
                var percentComplete = secondsElapsed * percentPerSecond;
                progressBar.css('width', percentComplete + '%').attr('aria-valuenow', percentComplete);
                var carsInspectedText = Math.floor(carsInspected);
                if (carsInspectedText == 1) {
                  carSuffix = "";
                } else {
                  carSuffix = "s";
                }
                progressBar.text(carsInspectedText + " Car" + carSuffix);
                carsInspected = carsInspected + .25;
            }, // callback for each second
            onCounterEnd: function () {
                var progressBar = $('.airbrake-intermediate-test-inspect-progress-bar')
                progressBar.css('width', '100%').attr('aria-valuenow', 100);
                progressBar.text(carsToInspect + " Car" + carSuffix);
                progressBar.addClass("progress-bar-success");
                $(".step-5").show();
            } // final action
        });
        countDown.start();
    });

    $(".airbrake-intermediate-test-release").click(function () {

        $(".airbrake-intermediate-test-release").hide();
        PlaySound("/sounds/bleedoff.wav");
        $(".airbrake-intermediate-test-release-badge").addClass("alert-success");
        $(".airbrake-intermediate-test-release-badge").text("Brakes Released");
        $(".airbrake-intermediate-test-release-badge").show();
        $(".step-6").show();

    });

    $(".airbrake-intermediate-test-inspect-release").click(function () {

        $(".airbrake-intermediate-test-inspect-release").hide();
        var carsToInspect = $("#airbrake-intermediate-test-car-count").val();
        var totalSeconds = parseInt(carsToInspect, 10);
        totalSeconds = totalSeconds * 4;

        carsPerSecond = carsToInspect / totalSeconds;
        percentPerSecond = 100 / totalSeconds;

        $(".airbrake-intermediate-test-inspect-release-progress").show();
        $(".airbrake-intermediate-test-inspect-release-progress").removeClass("hidden");

        carSuffix = "";

        var carsInspected = 0;
        var secondsElapsed = 0;
        var countDown = new Countdown({
            seconds: parseInt(totalSeconds),  // number of seconds to count down
            onUpdateStatus: function (sec) {
                secondsElapsed++;
                var progressBar = $('.airbrake-intermediate-test-inspect-release-progress-bar')
                var percentComplete = secondsElapsed * percentPerSecond;
                progressBar.css('width', percentComplete + '%').attr('aria-valuenow', percentComplete);
                var carsInspectedText = Math.floor(carsInspected);
                if (carsInspectedText == 1) {
                  carSuffix = "";
                } else {
                  carSuffix = "s";
                }
                progressBar.text(carsInspectedText + " Car" + carSuffix);
                carsInspected = carsInspected + .25;
            }, // callback for each second
            onCounterEnd: function () {
                var progressBar = $('.airbrake-intermediate-test-inspect-release-progress-bar')
                progressBar.css('width', '100%').attr('aria-valuenow', 100);
                progressBar.text(carsToInspect + " Car" + carSuffix);
                progressBar.addClass("progress-bar-success");
                $(".step-7").show();

        $(".airbrake-intermediate-test-success-badge").addClass("alert-success");
        $(".airbrake-intermediate-test-success-badge").text("Test Successful");
        $(".airbrake-intermediate-test-success-badge").show();
        $(".step-6").show();

            } // final action
        });
        countDown.start();
    });

});
</script>

</body>

</html>